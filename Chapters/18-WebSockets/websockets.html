<!DOCTYPE html>
<html>
  <head>
    <title>Pharo Book</title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<link rel="shortcut icon" href="images/favicon.png" type="image/x-icon" />
<link href="/DynamicWebDevelopmentWithSeaside/_support/html/css/font-awesome.min.css" rel="stylesheet">
<link href="/DynamicWebDevelopmentWithSeaside/_support/html/css/nucleus.css" rel="stylesheet">
<link href="/DynamicWebDevelopmentWithSeaside/_support/html/css/flex.css" rel="stylesheet">
<link rel="stylesheet" href="/DynamicWebDevelopmentWithSeaside/_support/html/css/bootstrap.min.css">
<script src="/DynamicWebDevelopmentWithSeaside/_support/html/js/jquery-2.x.min.js"></script>
<script src="/DynamicWebDevelopmentWithSeaside/_support/html/highlightjs/highlight.pack.js"></script>
<script src="/DynamicWebDevelopmentWithSeaside/_support/html/js/highlight-commands.js"></script>
<meta name="description" content="">
<meta name="author" content="StÃ©phane Ducasse \ (based on S. Ducasse, D.C. Shaffer, L. Renggli, and R. Zaccone)">
  </head>
  <body>
    <header>
  <div class="logo">
    <a class="baselink" href="/DynamicWebDevelopmentWithSeaside/">Pharo Book</a>
  </div>
  <div class="burger"><a href="javascript:void(0);" style="font-size:15px;">&#9776;</a></div>
  
</header>
<article>
  <aside>
    <ul class="menu">
   		<li data-nav-id="123" class="dd-item">
    		<a href="/DynamicWebDevelopmentWithSeaside">
		       <i class="fa fa-fw fa-home"></i>
	    	</a>
        </li>

		
		  <li class="dd-item  haschildren ">
			<div>
			  <a href="/DynamicWebDevelopmentWithSeaside/index.html#getting started">
					Getting Started
			  </a>
			   <i class="fa fa-angle-right fa-lg category-icon"></i> 
			</div>
			  <ul class="dd-item">
				
		   	  	<li class="dd-item  haschildren ">
					<div>
						<a href="/DynamicWebDevelopmentWithSeaside/Chapters/02-Gemstone/Gemstone.html#getting started in gemstone/s">
							Getting Started in Gemstone/S
						</a>
						<i class="fa fa-angle-right fa-lg category-icon"></i>
					</div>

					<ul class="dd-item">
							
						<li class="dd-item">
							<a href="/DynamicWebDevelopmentWithSeaside/Chapters/02-Gemstone/Gemstone.html#using the glass virtual appliance">Using the GLASS Virtual Appliance</a>
						</li>
							
						<li class="dd-item">
							<a href="/DynamicWebDevelopmentWithSeaside/Chapters/02-Gemstone/Gemstone.html#a first seaside component">A first Seaside Component</a>
						</li>
							
						<li class="dd-item">
							<a href="/DynamicWebDevelopmentWithSeaside/Chapters/02-Gemstone/Gemstone.html#defining a component">Defining a Component</a>
						</li>
							
						<li class="dd-item">
							<a href="/DynamicWebDevelopmentWithSeaside/Chapters/02-Gemstone/Gemstone.html#defining some methods">Defining Some Methods</a>
						</li>
							
						<li class="dd-item">
							<a href="/DynamicWebDevelopmentWithSeaside/Chapters/02-Gemstone/Gemstone.html#rendering a counter">Rendering a Counter</a>
						</li>
							
						<li class="dd-item">
							<a href="/DynamicWebDevelopmentWithSeaside/Chapters/02-Gemstone/Gemstone.html#registering the application">Registering the application</a>
						</li>
							
						<li class="dd-item">
							<a href="/DynamicWebDevelopmentWithSeaside/Chapters/02-Gemstone/Gemstone.html#adding behavior">Adding Behavior</a>
						</li>
							
						<li class="dd-item">
							<a href="/DynamicWebDevelopmentWithSeaside/Chapters/02-Gemstone/Gemstone.html#keeping up with the latest features">Keeping Up with the Latest Features</a>
						</li>
					
					</ul>						
				</li>
				
		   	  	<li class="dd-item ">
					<div>
						<a href="/DynamicWebDevelopmentWithSeaside/index.html#gemstone version">
							Gemstone version
						</a>
						
					</div>

					<ul class="dd-item">
					
					</ul>						
				</li>
				
			  </ul>
		  
		  </li>
		
		  <li class="dd-item ">
			<div>
			  <a href="/DynamicWebDevelopmentWithSeaside/index.html#fundamentals">
					Fundamentals
			  </a>
			  
			</div>
			  <ul class="dd-item">
				
			  </ul>
		  
		  </li>
		
		  <li class="dd-item ">
			<div>
			  <a href="/DynamicWebDevelopmentWithSeaside/index.html#using components">
					Using Components
			  </a>
			  
			</div>
			  <ul class="dd-item">
				
			  </ul>
		  
		  </li>
		
		  <li class="dd-item  haschildren ">
			<div>
			  <a href="/DynamicWebDevelopmentWithSeaside/index.html#seaside in action">
					Seaside in Action
			  </a>
			   <i class="fa fa-angle-right fa-lg category-icon"></i> 
			</div>
			  <ul class="dd-item">
				
		   	  	<li class="dd-item  haschildren ">
					<div>
						<a href="/DynamicWebDevelopmentWithSeaside/index.html#wish list of new chapter">
							Wish list of new chapter
						</a>
						<i class="fa fa-angle-right fa-lg category-icon"></i>
					</div>

					<ul class="dd-item">
							
						<li class="dd-item">
							<a href="/DynamicWebDevelopmentWithSeaside/index.html#willow?">Willow?</a>
						</li>
							
						<li class="dd-item">
							<a href="/DynamicWebDevelopmentWithSeaside/index.html#bootstrap">Bootstrap</a>
						</li>
							
						<li class="dd-item">
							<a href="/DynamicWebDevelopmentWithSeaside/index.html#mdl">MDL</a>
						</li>
							
						<li class="dd-item">
							<a href="/DynamicWebDevelopmentWithSeaside/index.html#mustaside">Mustaside</a>
						</li>
							
						<li class="dd-item">
							<a href="/DynamicWebDevelopmentWithSeaside/index.html#websockets">WebSockets</a>
						</li>
					
					</ul>						
				</li>
				
			  </ul>
		  
		  </li>
		
    </ul>
  </aside>

  <section class="page">
    
	<h1>Dynamic Web Development with Seaside</h1>
		
	<h2>WebSockets</h2>
<a id="cha:websockets"></a>
<p>
DRAFT
</p>
<h3>Concepts</h3>

<h3>Architecture</h3>

<h3>Studying a real case</h3>

<p>
<a href="https://github.com/TelescopeSt/TelescopeCytoscape">https://github.com/TelescopeSt/TelescopeCytoscape</a>
</p>
<p>
This project allow one to create a model of visualization (nodes and their
contents, layouts, interactions, and update mechanism) then to render it
with the CytoscapeJs visualization framework.
</p>
<p>
The Seaside part is really small. We just use Seaside to render an empty
div and initialize a cytoscape visualization inside. We could probably
do without Seaside but we did this project for a Seaside application.
(And we use the existing callbacks mechanism).
</p>
<p>
During the rendering we open a web socket and we generate the initial
cytoscape visualization inside the empty div generated by Seaside.
</p>
<p>
Then when the user interact with the visualization, it communicates the
interactions via the web socket to the Pharo server and if it should
impact the visualization, commands to do so are sent via the websocket
to the client.
</p>
<p>
In this project the main part for the websocket management are:
</p>
<ul>
<li>TLCytoscapeComponent : The Seaside component registering the</li>
</ul>
<p>
visualization
(<a href="https://github.com/TelescopeSt/TelescopeCytoscape/blob/development/src/Telescope-Cytoscape/TLCytoscapeComponent.class.st">https://github.com/TelescopeSt/TelescopeCytoscape/blob/development/src/Telescope-Cytoscape/TLCytoscapeComponent.class.st</a>)
</p><ul>
<li>TLCytoscapeWebSocketDelegate : The class managing the websocket server</li>
</ul>
<p>
side
(<a href="https://github.com/TelescopeSt/TelescopeCytoscape/blob/development/src/Telescope-Cytoscape/TLCytoscapeWebSocketDelegate.class.st">https://github.com/TelescopeSt/TelescopeCytoscape/blob/development/src/Telescope-Cytoscape/TLCytoscapeWebSocketDelegate.class.st</a>)
</p><ul>
<li>CYSFileLibrary&gt;&gt;cytoscapeTelescopeJs : The javascript managing the</li>
</ul>
<p>
socket client side
(<a href="https://github.com/TelescopeSt/TelescopeCytoscape/blob/development/src/Telescope-Cytoscape-Libraries/CYSFileLibrary.class.st#L539">https://github.com/TelescopeSt/TelescopeCytoscape/blob/development/src/Telescope-Cytoscape-Libraries/CYSFileLibrary.class.st#L539</a>)
</p>

<h3>The Component Part</h3>

<figure><pre><code>TLCytoscapeComponent &gt;&gt; visuDivId [
	visuDivId ifNil: [ visuDivId:= self class nextId ].
	^ visuDivId
]</code></pre><figcaption></figcaption></figure>

<figure><pre><code>TLCytoscapeComponent &gt;&gt; visuDivId: anObject [
	visuDivId := anObject
]</code></pre><figcaption></figcaption></figure>





<figure><pre><code>TLCytoscapeComponent &gt;&gt; renderContentOn: html [
	| visuId div callback |
	visuId := self visuDivId.
	div := html div
		id: visuId;
		style: self style;
		attributeAt: #isTelescopeVisu put: 'true';
		attributeAt: #'data-port' put: self webSocketPort;
		class: 'telescopeVisu';
		with: [ html div
				class: 'visualization';
				style: 'height: 100%; width: 100%;'.
			self waitingMessage value: html.
			self renderOptionalButtonsOn: html ];
		yourself.
	callback := WAValueCallback new.
	TLCytoscapeWebSocketDelegate
		registerVisualization: self visualization
		underId: visuId
		withCallBack: callback
		callbackUrl:
			{html actionUrl asString.
			(div storeCallback: callback)}
]</code></pre><figcaption></figcaption></figure>

<figure><pre><code>TLCytoscapeComponent &gt;&gt; renderOptionalButtonsOn: html [
	html div
		class: 'fitButton';
		with: [ self renderResetButtonOn: html.
			self exportStrategy renderDownloadButtonForVisu: self visuDivId on: html ]
]</code></pre><figcaption></figcaption></figure>

<figure><pre><code>TLCytoscapeComponent &gt;&gt; renderResetButtonOn: html [
	html anchor
		onClick: 'telescope.visuWithId(' , self visuDivId asString , ').fit();';
		with: 'Reset'
]</code></pre><figcaption></figcaption></figure>


<h3>Websocket server side</h3>

<p>
The class managing the websocket server
side (from <a href="https://github.com/TelescopeSt/TelescopeCytoscape/blob/development/src/Telescope-Cytoscape/TLCytoscapeWebSocketDelegate.class.st">https://github.com/TelescopeSt/TelescopeCytoscape/blob/development/src/Telescope-Cytoscape/TLCytoscapeWebSocketDelegate.class.st</a>)
</p>
<figure><pre><code>ZnWebSocketDelegate subclass: #TLCytoscapeWebSocketDelegate,
	instVars: 'visualizationByIdDictionary websocketByVisu'
	classInstVars: 'singleton development serverPort clientPort'</code></pre><figcaption></figcaption></figure>



<figure><pre><code>TLCytoscapeWebSocketDelegate class &gt;&gt; registerVisualization: aTLVisualization underId: aDivId withCallBack: aCallBack callbackUrl: callbackUrl [
	self ensureServerIsRunning.
	self singleton delegate
		registerVisualization: aTLVisualization
		underId: aDivId
		withCallBack: aCallBack
		callbackUrl: callbackUrl
]</code></pre><figcaption></figcaption></figure>

<figure><pre><code>initialize [
   super initialize.
   self visualizationByIdDictionary: Dictionary new.
   self websocketByVisu: Dictionary new.
   self
      handler: [ :webSocket | 
   		[ 
   			[ webSocket runWith: [ :message | self onMessageReceived: message webSocket: webSocket ] ]
   				on: ConnectionClosed
   				do: [ self freeResourcesFor: webSocket ] ]
   					on: PrimitiveFailed
   					do: [ self class restart ] ]
   ]</code></pre><figcaption></figcaption></figure>




  </section>

</article>

<footer>

<div class="footline">
    <div class="github-link">
      <a href="" target="blank"><i class="fa fa-code-fork"></i>Github</a>
    </div>
  </div>
</footer>

<script src="/DynamicWebDevelopmentWithSeaside/_support/html/js/clipboard.min.js"></script>


<link rel="stylesheet" href="/DynamicWebDevelopmentWithSeaside/_support/html/highlightjs/styles/default.css">
<link rel="stylesheet" href="/DynamicWebDevelopmentWithSeaside/_support/html/css/highlight-commands.css">
<link href="/DynamicWebDevelopmentWithSeaside/_support/html/css/featherlight.min.css" rel="stylesheet">
<script src="/DynamicWebDevelopmentWithSeaside/_support/html/js/featherlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
<script src="/DynamicWebDevelopmentWithSeaside/_support/html/js/flex.js"></script>
<!-- Prettify annotated paragraphs-->
    <script src="/DynamicWebDevelopmentWithSeaside/_support/html/js/annotated-paragraphs.js"></script>

  </body>
</html>
